<!DOCTYPE html>

<meta charset="utf-8">


<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

<meta property="og:url" content="https://axelknauf.github.io/">


<meta property="og:type" content="article">
<meta property="og:title" content="Linux: keeping files in sync with unison &middot; Knowledge Base">

<meta property="og:site_name" content="Knowledge Base">

<title>
    
    Linux: keeping files in sync with unison
    
</title>


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/styles/default.min.css">
<link rel="stylesheet" href="https://axelknauf.github.io//css/styles.css">
<link rel="stylesheet" href="https://axelknauf.github.io//css/custom.css">


<link rel="shortcut icon" href="https://axelknauf.github.io//assets/favicon.ico">


<link rel="alternate" type="application/rss+xml" title="RSS" href="https://axelknauf.github.io//index.xml">


<div class="container">
    <header class="nav">
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="https://axelknauf.github.io/">Knowledge Base</a>
                </div>

                <div class="collapse navbar-collapse" id="navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="https://axelknauf.github.io//post">All Posts</a></li>
                        <li><a href="https://axelknauf.github.io//tags">Tags</a></li>
                        
                        <li><a href="https://axelknauf.github.io/about/">About</a></li>
                        
                    </ul>

                    <ul class="nav navbar-nav navbar-right">
                        
                        
                        
                        
                    </ul>
                </div>
            </div>
        </nav>
    </header>


<div class="row">
    <div class="col-md-8">
        <article class="post">

            <header>
                <div class="post-date">
                    <span class="glyphicon glyphicon-calendar"></span>
                    <time datetime="Dec 27 2015">
                        Dec 27 2015
                    </time>
                </div>
                <h1 class="post-title">
                    <a href="https://axelknauf.github.io/post/linux-unison-synchronization/">Linux: keeping files in sync with unison</a>
                </h1>
            </header>

            <div class="post-content">
                

<p>In this post I would like to describe how to keep files in sync across two (or more) computers using a central storage and the useful tool <code>unison</code>.</p>

<h2 id="preparations:a6b9c1d3f6fa980bc7d7be7beaa2d553">Preparations</h2>

<p>In order to synchronize files across machines, you need the following:</p>

<ul>
<li>a folder on each machine which shall serve as synchronization point</li>
<li>a central storage, e. g. an SMB file share or some similar storage (may be SSH, ..)</li>
<li>the relevant software on each machine, details below</li>
</ul>

<h3 id="required-software:a6b9c1d3f6fa980bc7d7be7beaa2d553">Required Software</h3>

<p>I am running Ubuntu 15.10 on each machine, but the packages required are available for many distros, so this may easily work for you.</p>

<pre><code>    sudo apt-get install cifs-utils unison-gtk
</code></pre>

<p>I am using <code>cifs-utils</code> to locally mount a centrally-shared SMB drive (actually a USB thumb drive plugged into my Fritz Box and shared via SMBFS from there).</p>

<h2 id="setting-up-cifs:a6b9c1d3f6fa980bc7d7be7beaa2d553">Setting up CIFS</h2>

<p>In order to be able to locally mount the SMB share you first need to make it available on your host. Im my case - I am using a Fritz Box - this was quite easy, I will not write about this here. After having made it available on the network, you can mount it locally using these steps (derived from <a href="http://askubuntu.com/a/157140">this answer</a>):</p>

<p>First, create a credentials file in your home folder:</p>

<pre><code>    vim ~/.smbcredentials
</code></pre>

<p>Put your configuration settings in there:</p>

<pre><code>    username=username
    password=secret_password
    domain=workgroup_name
</code></pre>

<p>Make sure the file is only readable by your own user:</p>

<pre><code>    chmod 600 ~/.smbcredentials
</code></pre>

<p>Then, create a mount point where you want to have it available on your machine:</p>

<pre><code>    sudo mkdir /media/shared
</code></pre>

<p>Having set up the SMB credentials and the mount point, you can add the file share to your <code>/etc/fstab</code> so it gets automatically mounted each time you boot:</p>

<pre><code>    sudoedit /etc/fstab
</code></pre>

<p>Add a line similar to the following - you will have to adjust the values to fit your own paths and UID/GID. If you are unsure about the IDs, check the output of <code>id</code> for your user:</p>

<pre><code>    //server/share-name /media/shared cifs credentials=/home/username/.smbcredentials,uid=1000,gid=1000 0 0
</code></pre>

<p>If all pieces fit together you can now mount the share with</p>

<pre><code>    sudo mount -a
</code></pre>

<p>Now you have the remote folder mounted locally. Next we create a local folder in your home which shall be kept in sync with the remote one:</p>

<pre><code>    mkdir ~/shared
</code></pre>

<h2 id="setting-up-unison:a6b9c1d3f6fa980bc7d7be7beaa2d553">Setting up <code>unison</code></h2>

<p>Setting up unison is straight-forward. Usually being a CLI user, I went for the GTK UI this time. If your have not run unison before, it will automatically launch the new profile wizard to guide you through the process. Create a new profile, choose <code>~/shared</code> as first folder, then <code>/media/shared</code> as second folder and make sure to check the box for FAT FS compatibility, since the SMB share does not know about unix permissions and will yield errors if you omit it. In case you do, simple re-create the profile with the correct settings this time.</p>

<p>After having created the profile, unison will attempt an initial synchronization. You will get a warning message telling that there have been no archive folders, yet. This is okay, they are created when you first run unison and trigger the synchronization.</p>

<p>As result of the first synchroniation, <code>unison</code> will tell you about the differences, before anything happens. You can review the list of actions and if all is well, simple click on the &ldquo;Go!&rdquo; button to start the synchronization. During the first synch, it may well take some time, depending on the amount of data transferred and your network connection speed.</p>

<h2 id="adding-a-second-machine:a6b9c1d3f6fa980bc7d7be7beaa2d553">Adding a second machine</h2>

<p>Adding a second machine to synchronize looks identical to the first. You install the software, set up the SMB mount, configure unison and let it run. However, there may be different results depending on the starting conditions.</p>

<p>If the second machine did not have any files previously, <code>unison</code> will download everything initially, and you are fine. In case you already had a - mostly identical - copy of the shared files locally, <code>unison</code> may present you with a list of changed / updated files and you can choose how to synchronize them.</p>

<h2 id="synchronization-strategies:a6b9c1d3f6fa980bc7d7be7beaa2d553">Synchronization Strategies</h2>

<p>As described in <a href="http://www.cis.upenn.edu/~bcpierce/unison/download/releases/stable/unison-manual.html">the official documentation</a>, the best strategy to keep multiple machines in sync is to set up a spokes-and-hub network. This means that each client machine synchronizes with a central hub, much like many centrally managed SCMs work. Unison itself only supports two-node-synchronization, but running a central server like the SMB share above, solves this issue easily.</p>

<p>I hope this guide was useful. Happy hacking!</p>

<h2 id="links-and-docs:a6b9c1d3f6fa980bc7d7be7beaa2d553">Links and docs</h2>

<ul>
<li>Official homepage: <a href="http://www.cis.upenn.edu/~bcpierce/unison/docs.html">http://www.cis.upenn.edu/~bcpierce/unison/docs.html</a></li>
<li>Documentation below: <a href="http://www.cis.upenn.edu/~bcpierce/unison/download/releases/stable/unison-manual.html">http://www.cis.upenn.edu/~bcpierce/unison/download/releases/stable/unison-manual.html</a></li>
</ul>

            </div>

            <aside>
                
                <ul class="list-inline post-tags">
                    
                    <li>
                        <a href="https://axelknauf.github.io//tags/linux">
                            <i class="fa fa-tags"></i>
                            linux
                        </a>
                    </li>
                    
                </ul>

                
            
            <footer>

                <nav>
                    <ul class="pager">

                        
                        <li class="previous disabled"><a href="#"><span aria-hidden="true">&larr;</span> Older</a></li>
                        

                        <li><a href="https://axelknauf.github.io//post">All Posts</a></li>

                        
                        <li class="next"><a href="https://axelknauf.github.io/post/java-throttling-exception-limit/">Newer <span aria-hidden="true">&rarr;</span></a></li>
                        

                    </ul>
                </nav>

                
            </footer>

        </article>
    </div>
    <div class="col-md-4">
        
<aside>
    <div class="row">

        <div class="col-xs-12 col-sm-4 col-md-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h2 class="panel-title">Recent Posts</h2>
                </div>
                <div class="list-group">
                    
                    <a href="/post/linux-unison-synchronization/" class="list-group-item">Linux: keeping files in sync with unison</a>
                    
                    <a href="/post/java-throttling-exception-limit/" class="list-group-item">Java: Dynamic Event Throttling</a>
                    
                    <a href="/post/git-svn/" class="list-group-item">Using Git as SVN Client</a>
                    
                    <a href="/post/oracle-admin-snippets/" class="list-group-item">Oracle Administration Snippets</a>
                    
                    <a href="/post/linux-filesystem-snippets/" class="list-group-item">Linux Snippets</a>
                    
                    <a href="/post/xps13-9343/" class="list-group-item">Linux: Dell XPS 13 9343</a>
                    
                    <a href="/about/" class="list-group-item">About</a>
                    
                </div>
            </div>
        </div>

        <div class="col-xs-12 col-sm-4 col-md-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h2 class="panel-title">Tags</h2>
                </div>
                <div class="list-group">
                    
                    
                    
                    <a href="https://axelknauf.github.io//tags/algorithm" class="list-group-item">
                        <span class="badge">1</span>
                        algorithm
                    </a>
                    
                    
                    <a href="https://axelknauf.github.io//tags/dba" class="list-group-item">
                        <span class="badge">1</span>
                        dba
                    </a>
                    
                    
                    <a href="https://axelknauf.github.io//tags/git" class="list-group-item">
                        <span class="badge">1</span>
                        git
                    </a>
                    
                    
                    <a href="https://axelknauf.github.io//tags/java" class="list-group-item">
                        <span class="badge">1</span>
                        java
                    </a>
                    
                    
                    <a href="https://axelknauf.github.io//tags/linux" class="list-group-item">
                        <span class="badge">3</span>
                        linux
                    </a>
                    
                    
                    <a href="https://axelknauf.github.io//tags/oracle" class="list-group-item">
                        <span class="badge">1</span>
                        oracle
                    </a>
                    
                    
                    <a href="https://axelknauf.github.io//tags/svn" class="list-group-item">
                        <span class="badge">1</span>
                        svn
                    </a>
                    
                </div>
            </div>
        </div>

    </div>
</aside>

    </div>
</div>

</div>
<hr>

<footer class="container copy">
    <p>&copy; 2015  Axel Knauf </p>
	<p>Powered by <a href="http://gohugo.io" target="_blank">Hugo</a>, theme adapted from <a href="https://github.com/dim0627/hugo_theme_beg" target="_blank">beg</a> designed by <a href="https://twitter.com/dim0627" target="_blank">Daisuke Tsuji</a></p>
</footer>

<script src="//code.jquery.com/jquery-2.1.3.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script>
document.write('<script src="//sharebutton.net/plugin/sharebutton.php?type=horizontal&u=' + encodeURIComponent(document.location.href) + '"></scr' + 'ipt>');
</script>

