<!DOCTYPE html>

<meta charset="utf-8">


<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

<meta property="og:url" content="https://axelknauf.github.io/">


<meta property="og:type" content="article">
<meta property="og:title" content="Java: Dynamic Event Throttling &middot; Knowledge Base">

<meta property="og:site_name" content="Knowledge Base">

<title>
    
    Java: Dynamic Event Throttling
    
</title>


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/styles/default.min.css">
<link rel="stylesheet" href="https://axelknauf.github.io//css/styles.css">
<link rel="stylesheet" href="https://axelknauf.github.io//css/custom.css">


<link rel="shortcut icon" href="https://axelknauf.github.io//assets/favicon.ico">


<link rel="alternate" type="application/rss+xml" title="RSS" href="https://axelknauf.github.io//index.xml">


<div class="container">
    <header class="nav">
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="https://axelknauf.github.io/">Knowledge Base</a>
                </div>

                <div class="collapse navbar-collapse" id="navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="https://axelknauf.github.io//post">All Posts</a></li>
                        <li><a href="https://axelknauf.github.io//tags">Tags</a></li>
                        
                        <li><a href="https://axelknauf.github.io/about/">About</a></li>
                        
                    </ul>

                    <ul class="nav navbar-nav navbar-right">
                        
                        
                        
                        
                    </ul>
                </div>
            </div>
        </nav>
    </header>


<div class="row">
    <div class="col-md-8">
        <article class="post">

            <header>
                <div class="post-date">
                    <span class="glyphicon glyphicon-calendar"></span>
                    <time datetime="Dec 20 2015">
                        Dec 20 2015
                    </time>
                </div>
                <h1 class="post-title">
                    <a href="https://axelknauf.github.io/post/java-throttling-exception-limit/">Java: Dynamic Event Throttling</a>
                </h1>
            </header>

            <div class="post-content">
                

<p>In the code snippet described below I outline an algorithm for dynamically throttle the number of events occurring. In the example I limit the rate of exceptions being thrown, but theoretically this can be any kind of event, e. g. requests coming from some event source or user.</p>

<h2 id="throttling-rate-limiting-for-requests-or-in-this-case-exceptions:2ff4331f2a2cc91639ed40adb8607494">Throttling / rate limiting for requests (or in this case, exceptions)</h2>

<pre><code>    import java.util.Random;

    import org.junit.Test;

    public class Bar {

      private static final long rate = 10L; // ten exceptions allowed
      private static final long per = 60000L; // per minute (= 12.000
                          // milliseconds)
      private static long allowance = rate;
      private static long last = System.currentTimeMillis();

      @Test
      public void testThresholding() {
        // Algorithm adapted from:
        // http://stackoverflow.com/questions/667508/whats-a-good-rate-limiting-algorithm
        for (int i = 0; i &lt; 120; i++) {
          try {
            businessMethod();
          }
          catch (RuntimeException e) {
            long time = System.currentTimeMillis();
            long passedMs = Math.max(time - last, 1);
            last = time;

            double coeff = (double) rate / (double) per;
            long increment = Math.round(passedMs * coeff);

            allowance += increment;

            System.out.printf(&quot;-----------------------------\n&quot;);
            System.out.printf(&quot;time\t\t:%d\n&quot;, time);
            System.out.printf(&quot;passed (ms)\t:%d\n&quot;, passedMs);
            System.out.printf(&quot;increment\t:%d\n&quot;, increment);
            System.out.printf(&quot;allowance\t:%d\n&quot;, allowance);

            // Uncomment this block to enable throttling to the
            // defined rate.
            // if (allowance &gt; rate) {
            // allowance = rate; // throttle
            // }
            // System.out.printf(&quot;throttled\t:%d\n&quot;, allowance);

            if (allowance &lt; 1) {
              System.out.println(&quot;==&gt; too many exceptions!&quot;);
            }
            else {
              System.out.println(&quot;==&gt; still inside the limit.&quot;);
              allowance--;
            }

          }
        }
      }

      private void businessMethod() {
        // How many percent of business calls result in an exception
        final int exceptionPercent = 10;

        System.out.println(&quot;Business method&quot;);

        int val = new Random().nextInt(101);
        int delay = new Random().nextInt(1001);
        try {
          Thread.sleep(delay);
          if (val &lt;= exceptionPercent) {
            throw new RuntimeException(&quot;BusinessException&quot;);
          }
        }
        catch (InterruptedException e) {
          // ignore
        }
      }
    }
</code></pre>

            </div>

            <aside>
                
                <ul class="list-inline post-tags">
                    
                    <li>
                        <a href="https://axelknauf.github.io//tags/java">
                            <i class="fa fa-tags"></i>
                            java
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://axelknauf.github.io//tags/algorithm">
                            <i class="fa fa-tags"></i>
                            algorithm
                        </a>
                    </li>
                    
                </ul>

                
            
            <footer>

                <nav>
                    <ul class="pager">

                        
                        <li class="previous disabled"><a href="#"><span aria-hidden="true">&larr;</span> Older</a></li>
                        

                        <li><a href="https://axelknauf.github.io//post">All Posts</a></li>

                        
                        <li class="next"><a href="https://axelknauf.github.io/post/git-svn/">Newer <span aria-hidden="true">&rarr;</span></a></li>
                        

                    </ul>
                </nav>

                
            </footer>

        </article>
    </div>
    <div class="col-md-4">
        
<aside>
    <div class="row">

        <div class="col-xs-12 col-sm-4 col-md-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h2 class="panel-title">Recent Posts</h2>
                </div>
                <div class="list-group">
                    
                    <a href="/post/java-throttling-exception-limit/" class="list-group-item">Java: Dynamic Event Throttling</a>
                    
                    <a href="/post/git-svn/" class="list-group-item">Using Git as SVN Client</a>
                    
                    <a href="/post/oracle-admin-snippets/" class="list-group-item">Oracle Administration Snippets</a>
                    
                    <a href="/post/linux-filesystem-snippets/" class="list-group-item">Linux Snippets</a>
                    
                    <a href="/post/xps13-9343/" class="list-group-item">Linux: Dell XPS 13 9343</a>
                    
                    <a href="/about/" class="list-group-item">About</a>
                    
                </div>
            </div>
        </div>

        <div class="col-xs-12 col-sm-4 col-md-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h2 class="panel-title">Tags</h2>
                </div>
                <div class="list-group">
                    
                    
                    
                    <a href="https://axelknauf.github.io//tags/algorithm" class="list-group-item">
                        <span class="badge">1</span>
                        algorithm
                    </a>
                    
                    
                    <a href="https://axelknauf.github.io//tags/dba" class="list-group-item">
                        <span class="badge">1</span>
                        dba
                    </a>
                    
                    
                    <a href="https://axelknauf.github.io//tags/git" class="list-group-item">
                        <span class="badge">1</span>
                        git
                    </a>
                    
                    
                    <a href="https://axelknauf.github.io//tags/java" class="list-group-item">
                        <span class="badge">1</span>
                        java
                    </a>
                    
                    
                    <a href="https://axelknauf.github.io//tags/linux" class="list-group-item">
                        <span class="badge">2</span>
                        linux
                    </a>
                    
                    
                    <a href="https://axelknauf.github.io//tags/oracle" class="list-group-item">
                        <span class="badge">1</span>
                        oracle
                    </a>
                    
                    
                    <a href="https://axelknauf.github.io//tags/svn" class="list-group-item">
                        <span class="badge">1</span>
                        svn
                    </a>
                    
                </div>
            </div>
        </div>

    </div>
</aside>

    </div>
</div>

</div>
<hr>

<footer class="container copy">
    <p>&copy; 2015  Axel Knauf </p>
	<p>Powered by <a href="http://gohugo.io" target="_blank">Hugo</a>, theme adapted from <a href="https://github.com/dim0627/hugo_theme_beg" target="_blank">beg</a> designed by <a href="https://twitter.com/dim0627" target="_blank">Daisuke Tsuji</a></p>
</footer>

<script src="//code.jquery.com/jquery-2.1.3.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script>
document.write('<script src="//sharebutton.net/plugin/sharebutton.php?type=horizontal&u=' + encodeURIComponent(document.location.href) + '"></scr' + 'ipt>');
</script>

