<!DOCTYPE html>

<meta charset="utf-8">


<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

<meta property="og:url" content="https://axelknauf.github.io/">


<meta property="og:type" content="article">
<meta property="og:title" content="Oracle Administration snippets &middot; Knowledge Base">

<meta property="og:site_name" content="Knowledge Base">

<title>
    
    Oracle Administration snippets
    
</title>


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
<link rel="stylesheet" href="//yandex.st/highlightjs/8.0/styles/">
<link rel="stylesheet" href="https://axelknauf.github.io//css/styles.css">
<link rel="stylesheet" href="https://axelknauf.github.io//css/custom.css">


<link rel="shortcut icon" href="https://axelknauf.github.io//assets/favicon.ico">


<link rel="alternate" type="application/rss+xml" title="RSS" href="https://axelknauf.github.io//index.xml">


<div class="container">
    <header class="nav">
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="https://axelknauf.github.io/">Knowledge Base</a>
                </div>

                <div class="collapse navbar-collapse" id="navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="https://axelknauf.github.io//post">All Posts</a></li>
                        <li><a href="https://axelknauf.github.io//tags">Tags</a></li>
                        
                        <li><a href="https://axelknauf.github.io/">Welcome</a></li>
                        
                        <li><a href="https://axelknauf.github.io/about/">About</a></li>
                        
                    </ul>

                    <ul class="nav navbar-nav navbar-right">
                        
                        
                        
                        
                    </ul>
                </div>
            </div>
        </nav>
    </header>


<div class="row">
    <div class="col-md-8">
        <article class="post">

            <header>
                <div class="post-date">
                    <span class="glyphicon glyphicon-calendar"></span>
                    <time datetime="Dec 20 2015">
                        Dec 20 2015
                    </time>
                </div>
                <h1 class="post-title">
                    <a href="https://axelknauf.github.io/post/oracle-admin-snippets/">Oracle Administration snippets</a>
                </h1>
            </header>

            <div class="post-content">
                

<h3 id="check-for-blocking-locks:d09824b548f82fef46f982c408adadae">Check for blocking locks</h3>

<pre><code>    select s1.username || '@' || s1.machine
     || ' ( SID=' || s1.sid || ' )  is blocking '
        || s2.username || '@' || s2.machine || ' ( SID=' || s2.sid || ' ) ' AS blocking_status
        from v$lock l1, v$session s1, v$lock l2, v$session s2
        where s1.sid=l1.sid and s2.sid=l2.sid
        and l1.BLOCK=1 and l2.request &gt; 0
        and l1.id1 = l2.id1
        and l2.id2 = l2.id2;
</code></pre>

<h3 id="check-kill-user-sessions:d09824b548f82fef46f982c408adadae">Check / kill user sessions</h3>

<h4 id="show-all-sessions:d09824b548f82fef46f982c408adadae">Show all sessions</h4>

<pre><code>    select * from v$session;
</code></pre>

<h4 id="session-details:d09824b548f82fef46f982c408adadae">Session details</h4>

<pre><code>    SELECT se.osuser,se.username,se.status,se.sid &quot;O-sid&quot;,
    p.pid &quot;O-pid&quot; ,se.process &quot;user pid&quot;, p.spid &quot;wkg-pid&quot;,
    to_char(se.logon_time,'MM/DD/YY HH24:MI') &quot;logon&quot;,se.machine
    FROM v$session se, v$process p
    WHERE addr=paddr AND se.osuser IS NOT NULL AND se.username IS NOT NULL
    ORDER BY se.osuser
</code></pre>

<h4 id="kill-session-sid-serial-from-v-session-mentioned-above-execute-as-system:d09824b548f82fef46f982c408adadae">Kill session (sid &amp; serial# from v$session mentioned above, execute as SYSTEM)</h4>

<pre><code>    ALTER SYSTEM KILL SESSION 'sid,serial#';
</code></pre>

<h4 id="kill-session-the-hard-way-parameters-as-above:d09824b548f82fef46f982c408adadae">Kill session the hard way (parameters as above)</h4>

<pre><code>    ALTER SYSTEM KILL SESSION 'sid,serial#' IMMEDIATE;
</code></pre>

<h3 id="display-sql-for-sql-id:d09824b548f82fef46f982c408adadae">Display SQL for sql_id</h3>

<pre><code>    -- sql_id can be determined from v$session
    select * from v$sqlarea where sql_id= '3fmfmpj2kuuf7';
</code></pre>

<h3 id="locked-tables-and-objects:d09824b548f82fef46f982c408adadae">Locked tables and objects</h3>

<pre><code>    -- Locks by type
    SELECT session_id,lock_type, mode_held, mode_requested, blocking_others, lock_id1
    FROM dba_lock l
    WHERE lock_type NOT IN ('Media Recovery', 'Redo Thread');

    -- generally locked objects
    SELECT oracle_username USERNAME, owner OBJECT_OWNER,
    object_name, object_type, s.osuser,
    DECODE(l.block,
      0, 'Not Blocking',
      1, 'Blocking',
      2, 'Global') STATUS,
      DECODE(v.locked_mode,
        0, 'None',
        1, 'Null',
        2, 'Row-S (SS)',
        3, 'Row-X (SX)',
        4, 'Share',
        5, 'S/Row-X (SSX)',
        6, 'Exclusive', TO_CHAR(lmode)
      ) MODE_HELD
    FROM gv$locked_object v, dba_objects d,
    gv$lock l, gv$session s
    WHERE v.object_id = d.object_id
    AND (v.object_id = l.id1)
    and v.session_id = s.sid

    -- lock details
    SELECT SUBSTR(TO_CHAR(w.session_id),1,5) WSID, p1.spid WPID,
      SUBSTR(s1.username,1,12) &quot;WAITING User&quot;,
      SUBSTR(s1.osuser,1,8) &quot;OS User&quot;,
      SUBSTR(s1.program,1,20) &quot;WAITING Program&quot;,
      s1.client_info &quot;WAITING Client&quot;,
      SUBSTR(TO_CHAR(h.session_id),1,5) HSID, p2.spid HPID,
      SUBSTR(s2.username,1,12) &quot;HOLDING User&quot;,
      SUBSTR(s2.osuser,1,8) &quot;OS User&quot;,
      SUBSTR(s2.program,1,20) &quot;HOLDING Program&quot;,
      s2.client_info &quot;HOLDING Client&quot;,
      o.object_name &quot;HOLDING Object&quot;
    FROM gv$process p1, gv$process p2, gv$session s1,
      gv$session s2, dba_locks w, dba_locks h, dba_objects o
    WHERE w.last_convert &gt; 120
    AND h.mode_held != 'None'
    AND h.mode_held != 'Null'
    AND w.mode_requested != 'None'
    AND s1.row_wait_obj# = o.object_id
    AND w.lock_type(+) = h.lock_type
    AND w.lock_id1(+) = h.lock_id1
    AND w.lock_id2 (+) = h.lock_id2
    AND w.session_id = s1.sid (+)
    AND h.session_id = s2.sid (+)
    AND s1.paddr = p1.addr (+)
    AND s2.paddr = p2.addr (+)
    ORDER BY w.last_convert desc;
</code></pre>

<h3 id="tablespace-informations:d09824b548f82fef46f982c408adadae">Tablespace Informations</h3>

<pre><code>    select
       fs.tablespace_name                          &quot;Tablespace&quot;,
       (df.totalspace - fs.freespace)              &quot;Used MB&quot;,
       fs.freespace                                &quot;Free MB&quot;,
       df.totalspace                               &quot;Total MB&quot;,
       round(100 * (fs.freespace / df.totalspace)) &quot;Pct. Free&quot;
    from
       (select
          tablespace_name,
          round(sum(bytes) / 1048576) TotalSpace
       from
          dba_data_files
       group by
          tablespace_name
       ) df,
       (select
          tablespace_name,
          round(sum(bytes) / 1048576) FreeSpace
       from
          dba_free_space
       group by
          tablespace_name
       ) fs
    where
       df.tablespace_name = fs.tablespace_name;
</code></pre>

<h3 id="table-sizes-for-the-current-schema:d09824b548f82fef46f982c408adadae">Table sizes for the current schema</h3>

<pre><code>    SET serveroutput ON
    DECLARE
      CURSOR tabs
      IS
        SELECT object_name FROM user_objects WHERE object_type = 'TABLE';
      table_size_meg pls_integer := 0;
    BEGIN
      FOR t IN tabs
      LOOP
        BEGIN
          SELECT SUM(bytes)/(1024*1024)
          INTO table_size_meg
          FROM user_extents
          WHERE segment_type='TABLE'
          AND segment_name  = t.object_name
          GROUP BY segment_name;
          dbms_output.put_line(t.object_name || ': ' || table_size_meg || ' MB');
        EXCEPTION
        WHEN no_data_found THEN
          dbms_output.put_line('No data found.');
        END;
      END LOOP;
    END;
    /
</code></pre>

<h3 id="reverse-engineering-of-db-objects:d09824b548f82fef46f982c408adadae">Reverse Engineering of DB objects</h3>

<pre><code>    select DBMS_METADATA.GET_DDL('TABLE','table_name') from dual;
</code></pre>

<h3 id="create-db-links:d09824b548f82fef46f982c408adadae">Create DB links</h3>

<pre><code>    CREATE DATABASE LINK &quot;link_name&quot;
      CONNECT TO schema_name 
      IDENTIFIED BY pass
      USING 'tns definition (e. g. from tnsnames.ora)';
</code></pre>

<h3 id="determine-table-size-mb:d09824b548f82fef46f982c408adadae">Determine table size (MB)</h3>

<pre><code>    SELECT
      segment_name AS table_name,   
      Sum(bytes)/(1024*1024) table_size_meg
    FROM user_extents
    WHERE segment_type='TABLE'
    AND segment_name = 'table_name'
    GROUP BY segment_name
</code></pre>

<h3 id="check-compile-state-of-db-objects:d09824b548f82fef46f982c408adadae">Check compile state of DB objects</h3>

<pre><code>    SELECT o.object_type, o.object_name
    FROM user_objects o
    WHERE o.status &lt;&gt; 'VALID'
    AND o.object_type IN ('VIEW','PROCEDURE','FUNCTION','PACKAGE','TRIGGER')
</code></pre>

<h3 id="check-long-operations:d09824b548f82fef46f982c408adadae">Check long operations</h3>

<pre><code>    SELECT v.sid, se.osuser, se.machine, se.program, v.target, v.opname
    FROM V$SESSION_LONGOPS v, v$session se
    WHERE v.sid = se.sid
    AND v.username = 'user_name'
    ORDER BY se.machine 

    -- determine progress and remaining time
    SELECT
      To_Char(Floor(elapsed_seconds / 3600), 'FM09') || ':' || 
      To_Char(Floor(Mod(elapsed_seconds, 3600) / 60), 'FM09') || ':' || 
      To_Char(Mod(elapsed_seconds, 60), 'FM09') AS runtime,
      To_Char(Floor(time_remaining / 3600), 'FM09') || ':' || 
      To_Char(Floor(Mod(time_remaining, 3600) / 60), 'FM09') || ':' || 
      To_Char(Mod(time_remaining, 60), 'FM09') AS remaining,
      To_Char(((sofar / totalwork) * 100), 'FM99.99') || ' %' AS done_pct 
    FROM V$SESSION_LONGOPS v, v$session se
    WHERE v.sid = se.sid 
    AND v.target = 'schema_name.object_name'
    AND v.username = 'schema_name'
    AND se.sid = '&lt;sid&gt;';
</code></pre>

<h3 id="check-where-the-trace-file-for-current-session-is:d09824b548f82fef46f982c408adadae">Check where the trace file for current session is</h3>

<pre><code>    select 
      u_dump.value   || '/'     || 
      db_name.value  || '_ora_' || 
      v$process.spid || 
      nvl2(v$process.traceid,  '_' || v$process.traceid, null ) 
      || '.trc'  &quot;Trace File&quot;
    from 
                 v$parameter u_dump 
      cross join v$parameter db_name
      cross join v$process 
            join v$session 
              on v$process.addr = v$session.paddr
    where 
     u_dump.name   = 'user_dump_dest' and 
     db_name.name  = 'db_name'        and
     v$session.audsid=sys_context('userenv','sessionid');

    (from http://www.adp-gmbh.ch/ora/misc/find_trace_file.html)
</code></pre>

            </div>

            <aside>
                
                <ul class="list-inline post-tags">
                    
                    <li>
                        <a href="https://axelknauf.github.io//tags/oracle">
                            <i class="fa fa-tags"></i>
                            oracle
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://axelknauf.github.io//tags/dba">
                            <i class="fa fa-tags"></i>
                            dba
                        </a>
                    </li>
                    
                </ul>

                
            
            <footer>

                <nav>
                    <ul class="pager">

                        
                        <li class="previous"><a href="https://axelknauf.github.io/post/java-throttling-exception-limit/"><span aria-hidden="true">&larr;</span> Older</a></li>
                        

                        <li><a href="https://axelknauf.github.io//post">All Posts</a></li>

                        
                        <li class="next"><a href="https://axelknauf.github.io/post/linux-filesystem-snippets/">Newer <span aria-hidden="true">&rarr;</span></a></li>
                        

                    </ul>
                </nav>

                
            </footer>

        </article>
    </div>
    <div class="col-md-4">
        
<aside>
    <div class="row">

        <div class="col-xs-12 col-sm-4 col-md-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h2 class="panel-title">Recent Posts</h2>
                </div>
                <div class="list-group">
                    
                    <a href="/post/java-throttling-exception-limit/" class="list-group-item">java throttling exception limit</a>
                    
                    <a href="/post/oracle-admin-snippets/" class="list-group-item">Oracle Administration snippets</a>
                    
                    <a href="/post/linux-filesystem-snippets/" class="list-group-item">Linux snippets</a>
                    
                    <a href="/" class="list-group-item">Welcome</a>
                    
                    <a href="/post/git-svn/" class="list-group-item">Git als SVN Client nutzen</a>
                    
                    <a href="/about/" class="list-group-item">About</a>
                    
                </div>
            </div>
        </div>

        <div class="col-xs-12 col-sm-4 col-md-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h2 class="panel-title">Tags</h2>
                </div>
                <div class="list-group">
                    
                    
                    
                    <a href="https://axelknauf.github.io//tags/algorithm" class="list-group-item">
                        <span class="badge">1</span>
                        algorithm
                    </a>
                    
                    
                    <a href="https://axelknauf.github.io//tags/dba" class="list-group-item">
                        <span class="badge">1</span>
                        dba
                    </a>
                    
                    
                    <a href="https://axelknauf.github.io//tags/git" class="list-group-item">
                        <span class="badge">1</span>
                        git
                    </a>
                    
                    
                    <a href="https://axelknauf.github.io//tags/java" class="list-group-item">
                        <span class="badge">1</span>
                        java
                    </a>
                    
                    
                    <a href="https://axelknauf.github.io//tags/linux" class="list-group-item">
                        <span class="badge">1</span>
                        linux
                    </a>
                    
                    
                    <a href="https://axelknauf.github.io//tags/oracle" class="list-group-item">
                        <span class="badge">1</span>
                        oracle
                    </a>
                    
                    
                    <a href="https://axelknauf.github.io//tags/svn" class="list-group-item">
                        <span class="badge">1</span>
                        svn
                    </a>
                    
                </div>
            </div>
        </div>

    </div>
</aside>

    </div>
</div>

</div>
<hr>

<footer class="container copy">
    <p>&copy; 2015  Axel Knauf </p>
	<p>Powered by <a href="http://gohugo.io" target="_blank">Hugo</a></p>
	<p>Theme <a href="https://github.com/dim0627/hugo_theme_beg" target="_blank">beg</a> designed by <a href="https://www.facebook.com/daisuke.tsuji.735" target="_blank">Daisuke Tsuji</a></p>
</footer>

<script src="//code.jquery.com/jquery-2.1.3.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
<script src="//yandex.st/highlightjs/8.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script>
document.write('<script src="//sharebutton.net/plugin/sharebutton.php?type=horizontal&u=' + encodeURIComponent(document.location.href) + '"></scr' + 'ipt>');
</script>

